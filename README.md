# ShopScraper - 商品管理システム

オンラインショップの商品情報を効率的に管理し、Amazon販売における利益計算を自動化するシステムです。

## 🚀 主な機能

### 📊 商品情報管理
- **自動スクレイピング**: DHC・VT Cosmetics公式サイトから商品情報を自動取得
- **リアルタイム更新**: 最新の価格・セール情報を定期的に取得
- **商品検索・フィルタリング**: 商品名、価格、セール状況での絞り込み

### 💰 利益計算システム
- **ショップ別価格計算**: 
  - **VT Cosmetics**: 価格から400円引きで仕入れ価格を計算
  - **DHC**: セール価格から20%基本割引 + ユーザー設定割引（0-50%）
- **Amazon連携**: ASIN情報による販売価格・手数料の自動取得
- **利益指標**: 利益額、利益率、ROI（投資収益率）を自動計算

### 📈 ダッシュボード
- **KPI表示**: 総商品数、アクティブショップ数、セール商品数
- **アクティビティ監視**: スクレイピング履歴、価格変動の追跡
- **グラフ表示**: 商品数推移、アクティビティチャート

### 🔧 ASIN管理
- **手動登録**: 商品テーブルでの個別ASIN入力
- **一括登録**: Excel/CSVファイルからの大量ASIN登録
- **自動情報取得**: ASIN入力時の商品情報・手数料自動取得

## 🌐 プロキシ設定

### 環境変数設定

`.env.local` ファイルを作成し、以下の設定を行ってください：

```bash
# プロキシを使用する場合（本番環境）
USE_PROXY=true
PROXY_SERVER=http://150.61.8.70:10080
PROXY_USER=your_username
PROXY_PASS=your_password

# プロキシを使用しない場合（開発環境）
USE_PROXY=false
```

### プロキシ切り替え方法

1. **開発時（プロキシなし）**:
   ```bash
   USE_PROXY=false
   ```
   - 高速なローカル開発が可能
   - 外部プロキシサーバーへの依存なし

2. **本番環境（プロキシあり）**:
   ```bash
   USE_PROXY=true
   ```
   - IPブロック回避
   - 安定したスクレイピング実行

3. **設定変更後**: 
   ```bash
   npm run dev  # 開発サーバー再起動
   ```

### プロキシ状態確認

- **視覚的確認**: 各ショップページのプロキシ状態インジケーター
- **接続テスト**: 現在のIP・接続状態をリアルタイム確認
- **API確認**: `/api/proxy-status` エンドポイントで詳細情報取得

## 📦 セットアップ

### 1. 依存関係インストール
```bash
npm install
```

### 2. 環境変数設定
```bash
# サンプルファイルをコピー
cp .env.example .env.local

# .env.local を編集してプロキシ設定
nano .env.local
```

### 3. 開発サーバー起動
```bash
npm run dev
```

### 4. ブラウザでアクセス
```
http://localhost:3000
```

## 🛠️ 開発ガイド

### ディレクトリ構造
```
src/
├── app/                    # Next.js App Router
│   ├── api/               # API Routes
│   ├── dashboard/         # ダッシュボードページ
│   ├── shop/             # ショップページ
│   └── asin-upload/      # ASIN一括登録ページ
├── components/           # UIコンポーネント
│   ├── dashboard/        # ダッシュボード用
│   ├── layout/          # レイアウト
│   ├── product-list/    # 商品一覧用
│   └── ui/              # 基本UI
├── lib/                 # ユーティリティ・ライブラリ
│   ├── scrapers/        # スクレイピング処理
│   └── pricing-config.ts # ショップ別価格設定
├── hooks/               # カスタムフック
├── types/               # TypeScript型定義
└── data/                # データファイル
    ├── products/        # 商品データ
    └── asin/           # ASINデータ
```

### 新しいショップの追加

1. **スクレイパー作成**: `src/lib/scrapers/` に新しいスクレイパーを追加
2. **価格設定**: `src/lib/pricing-config.ts` にショップ別価格計算ルールを追加
3. **API更新**: `src/app/api/scraping/` でスクレイピングエンドポイントを更新

## 💡 利益計算の詳細

### VT Cosmetics
```
仕入れ価格 = セール価格（または通常価格） - 400円
利益額 = Amazon販売価格 - 販売手数料 - FBA手数料 - 仕入れ価格
```

### DHC
```
基本割引 = セール価格 × 20%
ユーザー割引 = セール価格 × ユーザー設定%（0-50%）
仕入れ価格 = セール価格 - 基本割引 - ユーザー割引
利益額 = Amazon販売価格 - 販売手数料 - FBA手数料 - 仕入れ価格
```

### 利益指標
- **利益率**: `(利益額 / 入金額) × 100`
- **ROI**: `(利益額 / 仕入れ価格) × 100`

## 🔍 トラブルシューティング

### よくある問題

#### プロキシ接続エラー
1. プロキシ設定の確認
2. 認証情報の確認
3. プロキシサーバーの稼働状況確認
4. `USE_PROXY=false` での直接接続テスト

#### スクレイピングエラー
1. プロキシ状態インジケーターで接続確認
2. 対象サイトのアクセス可能性確認
3. ブラウザコンソールでエラー詳細確認

#### データが表示されない
1. `src/data/products/` ディレクトリの存在確認
2. JSONファイルの形式確認
3. ファイル権限の確認

### ログ確認
```bash
# 開発サーバーのログ
npm run dev

# ブラウザコンソール
F12 → Console タブ
```

## 🚀 本番環境デプロイ

### Vercel（推奨）
```bash
# Vercel CLIインストール
npm i -g vercel

# デプロイ
vercel --prod
```

### 環境変数設定（Vercel）
```bash
vercel env add USE_PROXY
vercel env add PROXY_SERVER
vercel env add PROXY_USER
vercel env add PROXY_PASS
```

## 📊 パフォーマンス

### 最適化項目
- **SWRキャッシュ**: API レスポンスの効率的なキャッシュ
- **遅延読み込み**: 大量商品データの段階的読み込み
- **プロキシ切り替え**: 開発時の高速化

### 推奨スペック
- **メモリ**: 最小512MB、推奨1GB以上
- **ストレージ**: 最小1GB、推奨5GB以上
- **ネットワーク**: 安定したインターネット接続

## 🔒 セキュリティ

### データ保護
- **環境変数**: 機密情報の適切な管理
- **入力検証**: ASIN、価格データの検証
- **ファイル権限**: データファイルの適切な権限設定

### プロキシセキュリティ
- **認証**: ユーザー名・パスワード認証
- **暗号化**: HTTPS通信の使用
- **ログ管理**: 接続ログの適切な管理

## 📝 ライセンス

MIT License

## 🤝 コントリビューション

1. このリポジトリをフォーク
2. 機能ブランチを作成 (`git checkout -b feature/amazing-feature`)
3. 変更をコミット (`git commit -m 'Add amazing feature'`)
4. ブランチにプッシュ (`git push origin feature/amazing-feature`)
5. プルリクエストを作成

## 📞 サポート

問題や質問がある場合は、GitHubのIssuesページでお知らせください。